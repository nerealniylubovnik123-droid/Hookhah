<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Hookhan Mix</title>
  <style>
    body { background: #111; color: #eee; font-family: sans-serif; }
    button { padding: 8px 12px; margin: 5px; }
    input, textarea { width: 100%; margin: 5px 0; }
    .flavor { border: 1px solid #555; margin: 4px; padding: 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Hookhan Mix</h1>

  <section id="flavors">
    <h2>Все вкусы</h2>
    <div id="flavorList"></div>
  </section>

  <section id="admin">
    <h2>Админ · Добавить вкус</h2>
    <input id="admBrand" placeholder="Бренд">
    <input id="admName" placeholder="Название">
    <input id="admTags" placeholder="Теги (через запятую)">
    <input id="admDesc" placeholder="Описание">
    <input id="admStrength" type="number" placeholder="Крепость (1-10)">
    <button id="admAddFlavor">Сохранить вкус</button>
    <p><b>Токен:</b> <input id="admToken" placeholder="Введи ADMIN_TOKEN"></p>
    <button id="admSaveToken">Сохранить токен</button>
    <div id="admMsg"></div>
  </section>

  <section id="mixes">
    <h2>Миксы гостей</h2>
    <button onclick="addMix()">Добавить тестовый микс</button>
    <div id="mixList"></div>
  </section>

<script>
const API_BASE = "https://hookhah.onrender.com";
let adminToken = localStorage.getItem("admin_token") || "";

// ===== Загрузить вкусы
async function loadFlavors() {
  const res = await fetch(API_BASE + "/api/flavors");
  const data = await res.json();
  const list = document.getElementById("flavorList");
  list.innerHTML = "";
  data.forEach(f => {
    const div = document.createElement("div");
    div.className = "flavor";
    div.textContent = f.brand + " - " + f.name + " (" + (f.strength10||"-") + ")";
    list.appendChild(div);
  });
}

// ===== Добавить вкус (админ)
document.getElementById("admAddFlavor").onclick = async () => {
  const brand = document.getElementById("admBrand").value.trim();
  const name  = document.getElementById("admName").value.trim();
  const tags  = document.getElementById("admTags").value.trim();
  const desc  = document.getElementById("admDesc").value.trim();
  const str10 = document.getElementById("admStrength").value.trim();

  if (!brand || !name) {
    alert("Укажи бренд и название!");
    return;
  }

  const payload = {
    id: (brand + "-" + name).toLowerCase().replace(/\s+/g,"-"),
    brand, name,
    tags: tags ? tags.split(",").map(s => s.trim()) : [],
    description: desc,
    strength10: str10 ? Number(str10) : null
  };

  const res = await fetch(API_BASE + "/api/flavors", {
    method: "POST",
    headers: {
      "Content-Type": "application/json; charset=UTF-8",
      "X-Admin-Token": adminToken
    },
    body: JSON.stringify(payload)
  });

  if (!res.ok) {
    alert("Ошибка сохранения: " + res.status);
    return;
  }
  alert("Вкус добавлен!");
  loadFlavors();
};

// ===== Сохранение токена
document.getElementById("admSaveToken").onclick = () => {
  adminToken = document.getElementById("admToken").value.trim();
  localStorage.setItem("admin_token", adminToken);
  document.getElementById("admMsg").textContent = "Токен сохранён!";
};

// ===== Работа с миксами
async function loadMixes() {
  const res = await fetch(API_BASE + "/api/mixes");
  const data = await res.json();
  const list = document.getElementById("mixList");
  list.innerHTML = "";
  data.forEach(m => {
    const div = document.createElement("div");
    div.className = "flavor";
    div.textContent = m.title || "Без названия";
    const btn = document.createElement("button");
    btn.textContent = "Удалить";
    btn.onclick = async () => {
      await fetch(API_BASE + "/api/mixes/" + m.id, { method: "DELETE" });
      loadMixes();
    };
    div.appendChild(btn);
    list.appendChild(div);
  });
}

async function addMix() {
  const payload = { title: "Тестовый микс" };
  await fetch(API_BASE + "/api/mixes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  loadMixes();
}

// ===== Первичная загрузка
loadFlavors();
loadMixes();
</script>
</body>
</html>
